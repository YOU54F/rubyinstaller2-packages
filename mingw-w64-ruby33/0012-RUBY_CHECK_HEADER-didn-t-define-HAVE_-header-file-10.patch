From 1ab7c412d2e3880a7ad233c32e93961888f8145c Mon Sep 17 00:00:00 2001
From: Sorah Fukumori <sorah@cookpad.com>
Date: Fri, 31 May 2024 03:52:26 +0900
Subject: [PATCH] RUBY_CHECK_HEADER didn't define HAVE_{header-file} (#10876)

--with-gmp is not working at all because HAVE_GMP_H
was missing since 18eaf0be90. [Bug #20515]

bug: https://bugs.ruby-lang.org/issues/20515
follow-up: https://bugs.ruby-lang.org/issues/20494
follow-up: 18eaf0be905e3e251423b42d6f4e56b7cae1bc3b
follow-up: https://github.com/ruby/ruby/pull/10805
---
 tool/m4/ruby_check_header.m4 | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/tool/m4/ruby_check_header.m4 b/tool/m4/ruby_check_header.m4
index 171455549e..6fec9d16c5 100644
--- a/tool/m4/ruby_check_header.m4
+++ b/tool/m4/ruby_check_header.m4
@@ -3,6 +3,6 @@ AC_DEFUN([RUBY_CHECK_HEADER],
     [# RUBY_CHECK_HEADER($@)
     save_CPPFLAGS="$CPPFLAGS"
     CPPFLAGS="$CPPFLAGS m4_if([$5], [], [$INCFLAGS], [$5])"
-    AC_CHECK_HEADER([$1], [$2], [$3], [$4])
+    AC_CHECK_HEADERS([$1], [$2], [$3], [$4])
     CPPFLAGS="$save_CPPFLAGS"
     unset save_CPPFLAGS])
--- a/configure	2024-06-03 07:37:21.132692300 +0200
+++ b/configure	2024-06-03 07:37:32.296069200 +0200
@@ -14153,6 +14153,7 @@
     ac_fn_c_check_header_compile "$LINENO" "gmp.h" "ac_cv_header_gmp_h" "$ac_includes_default"
 if test "x$ac_cv_header_gmp_h" = xyes
 then :
+  printf "%s\n" "#define HAVE_GMP_H 1" >>confdefs.h
 
 fi
 
-- 
2.26.0.windows.1

